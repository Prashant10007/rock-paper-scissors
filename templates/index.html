<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Rock Paper Scissors</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(to right, #232526, #414345);
      color: white;
      text-align: center;
      padding: 40px;
    }
    h1 {
      font-size: 3em;
      margin-bottom: 10px;
    }
    #game, #waiting, #result, #scoreboard {
      display: none;
      margin-top: 30px;
    }
    .btn {
      padding: 12px 24px;
      margin: 10px;
      font-size: 1.2em;
      cursor: pointer;
      border: none;
      border-radius: 8px;
      background-color: #ffffff;
      color: #333;
    }
    .btn:hover {
      background-color: #ddd;
    }
    input {
      padding: 10px;
      font-size: 1em;
      width: 250px;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <h1>Rock Paper Scissors</h1>

  <div id="login">
    <input type="text" id="username" placeholder="Enter your name" />
    <br>
    <button class="btn" onclick="joinGame()">Join Game</button>
  </div>

  <div id="waiting">
    <p>Waiting for another player to join...</p>
  </div>

  <div id="game">
    <h2 id="opponent-info">You are playing against: </h2>
    <p>Choose your move:</p>
    <button class="btn" onclick="playMove('r')">Rock</button>
    <button class="btn" onclick="playMove('p')">Paper</button>
    <button class="btn" onclick="playMove('s')">Scissors</button>
  </div>

  <div id="result">
    <h3>Result:</h3>
    <p id="result-text"></p>
  </div>

  <div id="scoreboard">
    <h3>Scores</h3>
    <p id="scores"></p>
  </div>

  <script>
    const socket = io();
    let username = "";
    let currentRoom = "";

    function joinGame() {
      username = document.getElementById('username').value.trim();
      if (!username) {
        alert("Please enter a username.");
        return;
      }
      socket.emit('join', { username });
      document.getElementById('login').style.display = 'none';
      document.getElementById('waiting').style.display = 'block';
    }

    socket.on('waiting', (data) => {
      document.getElementById('waiting').style.display = 'block';
    });

    socket.on('start_game', (data) => {
      currentRoom = data.room;
      const opponent = data.opponent === username ? "Another player" : data.opponent;

      document.getElementById('waiting').style.display = 'none';
      document.getElementById('game').style.display = 'block';
      document.getElementById('opponent-info').innerText = `You are playing against: ${opponent}`;
    });

    function playMove(move) {
      socket.emit('play_move', {
        username: username,
        room: currentRoom,
        move: move
      });
      document.getElementById('game').style.display = 'none';
    }

    socket.on('result', (data) => {
      const [p1, p2] = data.players;
      const [m1, m2] = data.moves;
      let winner = "";

      if (data.winner === 'draw') {
        winner = "It's a draw!";
      } else if (data.winner === 'p1') {
        winner = `${p1} wins!`;
      } else if (data.winner === 'p2') {
        winner = `${p2} wins!`;
      } else {
        winner = "An error occurred.";
      }

      document.getElementById('result-text').innerText = `
        ${p1} played ${convertMove(m1)} | ${p2} played ${convertMove(m2)}\n${winner}
      `;
      document.getElementById('result').style.display = 'block';

      const scores = data.scores;
      document.getElementById('scores').innerText = `${p1}: ${scores[p1]} | ${p2}: ${scores[p2]}`;
      document.getElementById('scoreboard').style.display = 'block';
    });

    function convertMove(code) {
      return code === 'r' ? 'Rock' : code === 'p' ? 'Paper' : 'Scissors';
    }
  </script>
</body>
</html>
